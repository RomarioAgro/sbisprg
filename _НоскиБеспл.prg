Функция _АкцияНоскиБеспл()
{
пСтрокаМаг=";OD;UK;";
Если(Найти(пСтрокаМаг,КаСНОМ)==0) Вернуть(0);
#Акция с 7.02 по 07.03 при покупке 3-х вещей из списка, самая дешевая из них бесплатно
пСтрока.1=";3119;3120;3124;3125;3128;4215;4217;4223;4225;4227;4232;4238;5308;5309;6729;8242;8245;8246;8247;8727;8728;9309;9310;9511;9512;11508;12929;12930;12931;12932;12933;13265;13588;13589;13591;13608;13610;14443;"
пСтрока.2=";15522;15525;16079;16080;16081;16082;16391;16403;16405;16473;16475;16476;17045;17046;17047;17048;17049;17050;17051;17052;17053;17054;17055;17056;17057;17058;17059;17060;17061;17062;17063;17064;17065;18152;"
пСтрока.3=";18385;18386;18387;18388;20420;20903;20904;20929;22411;22412;22413;22419;22420;25874;27129;27130;27131;27132;27133;27551;28384;28808;28809;28810;28811;28814;31206;31207;31210;31213;31214;31215;31216;31221;"
пСтрока.4=";31224;31261;31609;31611;31612;31614;31617;31619;34356;34357;34361;34385;34386;34387;34388;34390;34391;34402;34403;34404;34406;34407;34408;34409;37096;37098;37101;39457;39459;39461;39463;40773;40775;40777;"
пСтрока.5=";43790;43792;46080;46082;46084;46086;46513;46515;46517;46519;46521;46523;46525;46527;46529;46531;46533;46536;46538;46540;46542;46544;46546;46548;46552;46557;46559;46561;46562;46564;46566;46567;46569;46571;"
пСтрока.6=";46574;46576;46578;46580;46586;46594;46596;46599;46600;46602;46603;46605;46606;46607;46608;46611;46612;46613;46614;46617;46618;46620;46622;46623;46625;46626;46628;46629;46630;47582;47586;47588;50215;50217;"
пСтрока.7=";51511;51513;51515;52409;52411;52412;52413;52414;52415;52416;52417;52418;52419;52420;52421;52422;52423;52424;52425;52426;52427;52430;52434;52446;52448;52449;52450;52451;52453;52454;54405;54407;54409;54410;"
пСтрока.8=";54411;54412;54735;54738;54740;54765;54767;54768;54769;54770;54771;54818;54819;54820;54823;54824;54825;54826;54828;54830;54832;54833;54834;54837;54838;54840;54841;57063;57066;57155;57157;57159;63498;63499;"
пСтрока.9=";63501;63503;66796;66803;66805;66807;66809;66813;66815;66818;67721;67722;67725;67746;67771;67772;67773;67774;67775;67776;67780;67782;67783;67784;67795;67796;67797;67798;67803;67807;69542;69543;69551;69553;"
пСтрока.10=";69554;72419;72422;72425;72429;72434;72438;72498;72501;72504;72512;72552;72553;72554;72577;72580;72581;72589;72592;72596;72597;72601;72602;72603;75704;75708;75709;75710;75711;75712;75713;75714;75723;75724;"
пСтрока.11=";75725;75726;75727;75730;79827;79832;79833;79834;79835;79836;79837;79838;79839;79840;79841;79842;79843;79844;79852;79853;79867;79868;79869;83465;83713;83714;83715;86428;86442;86443;86444;86445;87183;87186;"
пСтрока.12=";87190;87193;87194;87196;87199;87201;87204;87206;87207;87208;87211;87213;87214;87215;87216;87217;87248;87250;90122;90124;90126;90128;90130;90132;90134;90137;90141;90143;90146;90156;90157;90161;90165;90166;"
пСтрока.13=";90236;90310;94571;94572;94573;94574;94575;94576;94577;94578;94579;94580;94581;94619;94620;94621;94622;94623;94624;94625;94626;94627;94628;97273;97274;97275;97276;97277;97278;97279;97280;97281;97282;97283;"
пСтрока.14=";97284;97285;97286;97287;97288;97289;97292;99131;99135;99138;99141;99144;99147;99156;99161;99164;99167;99170;99173;99176;99180;99183;99186;99189;99193;99198;99201;99204;99209;106387;106390;106392;106395;"
пСтрока.15=";106397;106399;106401;112400;112407;112408;112409;112410;112411;112412;112413;112414;112415;112416;112417;113246;113248;113250;113252;113254;113256;113258;113260;113262;113264;113266;113268;113279;113281;"
пСтрока.16=";113283;113285;113287;113289;113291;113296;113298;113300;113306;113308;114563;114564;115009;115010;115011;115012;115013;115562;115564;115565;117031;117032;117035;117038;117040;117041;117045;117046;117047;"
пСтрока.17=";117048;117049;117050;124021;124023;124572;124779;125679;125991;125995;125998;126001;126003;126005;126007;126009;126011;134588;134589;134590;134591;134592;134593;134594;134595;134596;139817;139818;"

#оставим пустую строку, мало ли надо будет добавить что-нить в акцию

пКолСтрокАкции=18;#количество строк длиной меньше 255 символов
пКолАкции=0;
пСтрокаАкции="";
пСтрокаАкции2="";
пСуммаДжемп=10000;
пСуммаДжемп2=0;
пКодАрт2=0;

Р=0;
#Очистить(оМасТов);
ДляВСех(Наименований())
{     
пСч=1;  
пКодАрт=";"+'Наим.Иерархия.НомНомер'+";";
пКодАртЦвет=ПодСтрока('Наим.НомНомер',2,10);
пКатегория=";"+'Наим.ИЕРАРХИЯ.Иерархия.НомНомер'+";";
#отладить();
Если(Наим.СуммаЦен>0)
   {
    Пока(пСч<пКолСтрокАкции)
         {
            Если(Найти(пСтрока[пСч], пКодАрт)!=0)
               {#если нашли в списке товаров из акции наш товар,то выходим из цикла поиска         
                пСч=1000;#типа выход из цикла   
               пКолАкции+=Наим.Кол_во;
               если(пСуммаДжемп>Наим.Цена)
               {
                  пСуммаДжемп=Наим.Цена;
                  пСтрокаАкции=пКодАрт;
               }
               }
            пСч++;
         }
   }
}
если(пКолАкции>=3)
{
пСуммаДжемп2=пСуммаДжемп;
ДляВСех(Наименований())
{
      Если(Найти(пСтрокаАкции, 'Наим.Иерархия.НомНомер')!=0)
      {                      
         Наим.СуммаЦен=Окр((пСуммаДжемп2*Наим.Кол_во-пСуммаДжемп),1);
         пСуммаДжемп=0;         
         если(пКолАкции>1)
         {
            '.Примечание'="Носки подарок";
         }
         Сохранить(Наим);
      }     
}

}
}