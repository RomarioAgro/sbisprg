Функция _ДобавитьНаимПоКоду(пТаблица)
{
   оНом=Выборка("Номенклатура");#делаем выборку из БД по номенклатуре?
   оНом.НомНомер='@Штрих-Код';
   Найти(оНом,"НомНомер");
   фНашли=0;
   Если(оНом.НомНомер!='@Штрих-Код')
   {
      оКод=Выборка("Штрих-коды");
      оКод.Код='@Штрих-Код';
      Найти(оКод,"Код");
      Если(оКод.Код=='@Штрих-Код')
      {
         оНом='оКод.Номенклатура-Коды';
         фНашли=1;
      }
   }
   Иначе фНашли=1;
   Если(ЭтоУзел(оНом)) фНашли=0;#это что?
   Если(фНашли)
   {
      пНпп=1; фДобавлять=1;
      ДляВсех(Наименований)
      {
#         Если('N п/п'>9000) { 'N п/п'-=9000; Сохранить(Наим); }
         пНпп=Макс('N п/п',пНпп);
         Если(НомНомер==оНом.НомНомер И фНашли)
         {
            пКол_во=Наим.Кол_во;
            Очистить(Наим.Кол_во);
            Наим.Кол_во=пКол_во+1;
#            'Наим.N п/п'+=9000;
            Сохранить(Наим);
            фНашли=0; фДобавлять=0;
         }
      }
      Если(фДобавлять)
      {
         оНаим=Выборка(пТаблица);
         Связать(["оНаим.Накладная-"+пТаблица],Документ);
         оКарточкаСклада=Объект( "Складская картотека");
         'оКарточкаСклада.N склада'='Документ.Склад.N склада';
         Связать('оКарточкаСклада.Номенклатура-Склад',оНом);
         Если(Найти(оКарточкаСклада,"Номенклатура-Склад")<= 0)
         {
            оКарточкаСклада=Выборка( "Складская картотека" );
            'оКарточкаСклада.N склада'='Документ.Склад.N склада';
            Связать(оКарточкаСклада.Склады,Документ.Склад);
            Связать('оКарточкаСклада.Номенклатура-Склад',оНом);
            оКарточкаСклада.Наименование = оНом.Наименование;
            Добавить(оКарточкаСклада);
         }
         Связать(["оНаим.Склад-"+пТаблица],оКарточкаСклада);
         оНаим.Кол_во=1;
#         'оНаим.N п/п'=9000+пНпп+1;
### Выбор продавца
#         Отладить();
         Если(Найти('Папки.Примечание',"КАССА") ИЛИ 
              Найти('Папки.Примечание',"ПРОДАЖА"))
         {
            Объект оДиалог=СоздатьДиалог("Выбор продавца");
            пКодПродавца="";
            Пока(!пКодПродавца)
            {
               ВыполнитьДиалог(оДиалог);
               пКодПродавца='оДиалог.@Код';
               пНазПродавца='оДиалог.@Продавец';
               оНаим.Продавец=пКодПродавца+"|"+пНазПродавца;
            }
         }
### Выбор продавца
         Добавить(оНаим);
      }
      '@Штрих-Код'="";
   }
   Иначе Сообщить("НЕ НАЙДЕН ТОВАР С КОДОМ\n"+'@Штрих-Код'+" !");
}
