
# обработчик диалога 'АктивДиск'
функция 'АктивДиск'(Событие, Поле)
{
   ВыборПо(Событие)
   {
      выбор "Инициализация":
         Дата=ТекДат;
         

         Вернуть "";
      выбор "Изменение":
         Вернуть "";
      выбор "Сохранение":
        Если(Код!="")
           {
               Код2=Подстрока(Код,1,12);
               Код="";
               оЧЛ = Объект( "Частные лица" );
               оЧЛ.ИНН=Код2;
               Найти(оЧЛ,"ИНН");
                  Если( Код2=='оЧЛ.ИНН' )
                     {
                        Номер='оЧЛ.Название';
                        ФИО='оЧЛ.ФИО';
                        Если('оЧЛ.Год рождения') Дата='оЧЛ.Год рождения';
                        Разбить(оЧЛ.Примечание,"|",КодВорд,Телефон);
                        Разбить(оЧЛ.Паспорт,",",п1,п2,п3,ДеньРожд);
                        Разбить(оЧЛ.Адрес,",",Индекс,Город,Улица,Дом,Квартира);
                        Поле="ФИО";
                     }
                  Иначе 
                     {
                        Сообщить("Не найдена карта с таким Кодом!");
                        Поле="Код";
                     }
              Вернуть(Поле);
           }
        Иначе
            оЧЛ = Объект( "Частные лица" );
            оЧЛ.ИНН=Код2;
#            Отладить();
            Найти(оЧЛ,"ИНН");
#            Отладить()
               Если( 'оЧЛ.ИНН'==Код2 )
                  {
                     'оЧЛ.ФИО'=ФИО;
                     'оЧЛ.Год рождения'=Дата;
                     'ОЧЛ.Адрес'=Индекс+","+Город+","+Улица+","+Дом+","+Квартира;
                     Разбить(ОЧЛ.Паспорт,",",проц,п1,п2,п3,п4);
                      ОЧЛ.Паспорт=проц+","+п1+","+п2+","+ДеньРожд;
                     'ОЧЛ.Примечание'=КодВорд+"|"+Телефон;
#                     отладить();
                     Сохранить(ОЧЛ);
                     пИмя  = "DISC"+КАСНОМ;
                     оФайл = Объект( "x:\\"+пИмя+".TXT");
                     оФайл.Строка=ТекВремя+";"+оЧЛ.ИНН+";"+оЧЛ.ФИО+";"+оЧЛ.Название+";"+'оЧЛ.Год рождения'+";"+ОЧЛ.Паспорт+";"+'ОЧЛ.Адрес'+";"+'ОЧЛ.Примечание'+";";
                     Добавить(оФайл);
                     Очистить(оФайл);
                     оФайл=НЕТ;
#                     Запустить("C:\\util\\putty\\psftp.exe -2 -4 -batch -pw 1a1b9269 det_mir@192.168.0.100 -b c:\\util\\putty\\server4.scr",1);
                     Сообщить("Карта удачно Активирована!");
                  }
        Вернуть "";
   }
   Вернуть "";
}