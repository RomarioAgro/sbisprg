Функция _АкцияТретьяВещь()
{
#Акция с 7.02 по 07.03 при покупке 3-х вещей из списка, самая дешевая из них бесплатно
пСтрокаМаг=";BK;CB;EU;OD;OK;OO;SB;SD;SL;UK;UM;US;UZ;";
Если(Найти(пСтрокаМаг,КаСНОМ)==0) Вернуть(0);

пСтрока.1=";2144;2428;2441;2452;2456;2471;2497;2519;2529;6240;6665;7950;9565;15837;17822;20105;21746;21755;21783;21790;21791;22893;23369;23374;23377;23386;23705;23851;23855;24458;24845;25234;25393;25573;25888;26754;"
пСтрока.2=";27056;29096;30323;32708;34230;34738;34822;34823;34826;35160;35161;36228;37391;38344;38872;39782;39787;39900;40054;40649;40735;40919;41609;41610;41614;41619;41625;41826;42295;43300;43718;44480;47189;47849;"
пСтрока.3=";47855;48610;51119;51132;51134;51136;51138;51143;51210;51287;51450;51800;52921;53604;53833;55802;56029;56037;56400;56579;57344;57736;58562;59283;61510;62254;62681;63453;63454;67152;67304;69222;69247;69518;"
пСтрока.4=";71405;71426;71803;71806;71809;73462;77234;77769;77881;77882;78157;78401;78523;87506;89355;92627;92741;94277;96056;96257;96570;96571;103147;103151;103158;105544;106150;107067;107926;107931;111270;111973;"
пСтрока.5=";111975;111986;111992;111994;111996;112775;112792;113629;113631;114276;114278;114284;114288;114932;114978;114995;115115;115137;116177;116198;116199;116203;116204;116205;116206;116207;116208;116209;117054;"
пСтрока.6=";117545;117763;118205;118207;118709;118853;119404;119581;119756;119782;119783;119784;119808;120154;120162;120691;120696;120699;120702;121803;121815;122221;122227;122230;122240;122586;123185;123252;124466;"
пСтрока.7=";124475;124484;124497;124503;124505;124511;124514;124873;124888;124891;124893;124896;124897;124911;126161;126163;126164;126169;126173;126176;126182;126344;126348;127287;127291;127292;127293;127297;127303;"
пСтрока.8=";127309;127314;127685;128001;128002;128112;128116;128126;128127;129615;129642;129659;130659;131699;131714;131719;133341;134820;135357;136956;136957;136963;136964;138646;138647;139506;139511;139513;139514;"
пСтрока.9=";139516;139520;139526;139528;139996;141523;141547;141551;141552;141553;141554;142484;142486;142489;142490;142491;142494;142500;142501;189859;189860;189863;189868;189869;189871;189873;190724;190750;"
пСтрока.10=";191065;191058;56404;41949;87505;87506;47189;190758;51408;47190;80093;190751;190757;190756;142485;131716;129867;119420;131715;131717;43328;77769;119963;134865;123184;134864;141555;108468;108807;108805"
пСтрока.11=";2144;6665;6840;9573;15837;21771;23705;24458;42295;51132;51134;51138;51804;56400;59275;62678;62681;66051;71803;71806;77881;77882;92623;92624;98823;103145;107067;107926;107931;114983;119341;119777;119782;"
пСтрока.12=";119783;119784;119808;120691;120696;120699;120702;122216;122218;122221;122227;123184;124475;124503;124511;124873;124893;124896;126169;126176;127286;127299;127685;128001;128013;128015;128127;129615;131699;"
пСтрока.13=";136967;139514;139516;139522;141522;139524;139505;139524;122689;71423;122687;132647;104500;118210;118210;132360;130091;130089;89903;136108;120229;118854;108471;103153;74706;117560;133213;125012;133209;"
пСтрока.14=";2144;2477;23354;24458;40844;40845;42295;43325;48593;48595;48597;48599;48617;51150;51154;51161;51798;51804;56037;62254;63882;65793;69222;71405;71423;71426;73462;73465;74706;78154;81058;86851;86853;87507;"
пСтрока.15=";87511;87800;89365;90572;91089;92734;92741;93383;93386;94272;94915;94954;97662;98533;98813;98823;98824;100288;100927;100944;101471;102384;102385;102387;102404;102405;102407;102410;105547;107067;107095;107653;"
пСтрока.16=";107931;108468;108471;108800;108805;108807;108814;108847;109294;109295;109297;109298;109301;111270;111282;111286;111288;111293;113629;113630;113864;113866;113867;113871;114083;116314;116317;116318;116319;"
пСтрока.17=";116425;116979;117341;117342;117343;117538;117539;117555;117556;117557;117558;117559;117674;117675;118205;118207;118208;118209;118210;118295;118297;118379;118438;118629;118711;118717;118771;118853;118854;"
пСтрока.18=";118855;118856;119303;119373;119375;119425;119650;119652;119653;119654;119775;119780;119782;119784;119799;120139;120223;120225;120226;120227;120228;120229;120230;120231;120233;120234;120691;120696;120699;"
пСтрока.19=";121138;121142;122230;122687;122689;122690;122691;124542;124544;124546;124547;124548;124892;124999;126161;126169;126337;126338;127159;127160;127161;127291;127303;127309;127690;127713;128010;128058;128060;"
пСтрока.20=";128061;128116;129607;129615;129616;129867;130655;130658;130661;130662;131699;131727;132384;132639;132641;132642;132643;132976;132990;133050;133209;133213;133214;133341;134391;134861;134872;135264;135265;"
пСтрока.21=";135266;135904;136108;136109;136110;138650;138651;138957;138958;138960;138961;138965;138969;139526;140661;140662;141447;141449;141550;141551;141555;142403;142404;142405;142406;142484;142487;142489;142490;"
пСтрока.22=";142491;142496;189856;189860;189873;191228;191229;191230;133052;"

пСтрокаЦвет.1=""
пСтрокаЦвет.2=""
пСтрокаЦвет.3=""

#оставим пустую строку, мало ли надо будет добавить что-нить в акцию

пКолСтрокАкции=23;#количество строк длиной меньше 255 символов
пКолСтрокАкции2=4;#количество строк длиной меньше 255 символов
пКолАкции=0;
пСтрокаАкции="";
пСтрокаАкции2="";
пСуммаДжемп=10000;
пСуммаДжемп2=0;
пКодАрт2=0;

Р=0;
#Очистить(оМасТов);
ДляВСех(Наименований())
{     
пСч=1;  
пКодАрт=";"+'Наим.Иерархия.НомНомер'+";";
пКодАртЦвет=ПодСтрока('Наим.НомНомер',2,10);
пКатегория=";"+'Наим.ИЕРАРХИЯ.Иерархия.НомНомер'+";";
#отладить();
Если(Наим.СуммаЦен>0)
   {
    Пока(пСч<пКолСтрокАкции)
         {
#            Если(Найти(пСтрока[пСч], пКодАрт)!=0)
            Если(Третья_вещь_бесплатно_в_ЧП2_16(пКодАрт)!=0)
               {#если нашли в списке товаров из акции наш товар,то выходим из цикла поиска
               пСч=1000;#типа выход из цикла               
               пКолАкции+=Наим.Кол_во;
               если(пСуммаДжемп>Наим.Цена)
               {
                  пСуммаДжемп=Наим.Цена;
                  пСтрокаАкции=пКодАрт;
               }
               }
            пСч++;
         }
         #отладить();
#    Если (пСч<1000)
#         {
            пСч2=1;
            Пока(пСч2<пКолСтрокАкции2)
            {
            Если(Найти(пСтрокаЦвет[пСч2], пКодАртЦвет)!=0)
               {#если нашли в списке товаров из акции наш товар,то выходим из цикла поиска
               пСч=1000;#типа выход из цикла               
               пКолАкции+=Наим.Кол_во;
               если(пСуммаДжемп>Наим.Цена3)
               {
                  пСуммаДжемп=Наим.Цена;
                  пСтрокаАкции=пКодАртЦвет;
               }
               }
            пСч2++;
            }
#         }
             
   }
}
#отладить();
#Имя="";
#ДляВсех( Элементов(оМасТов, Имя))
#   сообщить(Имя);
       
если(пКолАкции>=3)
{
пСуммаДжемп2=пСуммаДжемп;
ДляВСех(Наименований())
{
   #отладить();
   Р=Размер(пСтрокаАкции);
   Если(Размер(пСтрокаАкции)>8)
   {
      Если(Найти('Наим.НомНомер', пСтрокаАкции)!=0)
      {                      
         Наим.СуммаЦен=Окр((пСуммаДжемп2*Наим.Кол_во-пСуммаДжемп),1);
         пСуммаДжемп=0;
         если(пКолАкции>1)
         {
            '.Примечание'="Третья бесплатно";
         }
         Сохранить(Наим);
      }
   }
   иначе
   {
      Если(Найти(пСтрокаАкции, 'Наим.Иерархия.НомНомер')!=0)
      {                      
         Наим.СуммаЦен=Окр((пСуммаДжемп2*Наим.Кол_во-пСуммаДжемп),1);
         пСуммаДжемп=0;         
         если(пКолАкции>1)
         {
            '.Примечание'="Третья бесплатно";
         }
         Сохранить(Наим);
      }     
   }
}

}
}