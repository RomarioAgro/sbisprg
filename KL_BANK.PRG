# Функции, используемые для импорта экспорта во все системы клиент банк

# Работа с названием банка

Функция НазваниеБанка( Название )
# Возвращает название банка
# Параметр - название банка, содержащее последним словом название города
{
   # Уберем пробелы
   Название = Текст(Название, "Текст в");
   Перем НазвБанка = НазвГорода = "";
   Если( Название )
   {
      Объект мСлова;
      Разбить( Название, " ", мСлова);
      Перем Нпп = 1;
      Пока( Нпп < Размер( мСлова ) )
      {
         НазвБанка = НазвБанка + ( НазвБанка ? " " : "" ) + мСлова[Нпп];
         Нпп++;
      }
      НазвГорода = мСлова[Нпп];
   }
   Если( Вверх( Подстрока(НазвГорода, 1, 2 ) ) != "Г." )
   {
      Если( НазвГорода )
      {
         НазвБанка = НазвБанка + " " + НазвГорода;
         НазвГорода = "";
      }
      Сообщить( "У банка " + Название + "\nне указан город (Г.ГОРОД) в конце названия" );
   }
   Вернуть НазвБанка;
}

Функция ГородБанка( Название )
# Возвращает город банка
# Параметр - название банка, содержащее последним словом название города
{
   # Уберем пробелы
   Название = Текст(Название, "Текст в");
   Перем НазвБанка = НазвГорода = "";
   Если( Название )
   {
      Объект мСлова;
      Разбить( Название, " ", мСлова);
      Перем Нпп = 1;
      Пока( Нпп < Размер( мСлова ) )
      {
         НазвБанка = НазвБанка + ( НазвБанка ? " " : "" ) + мСлова[Нпп];
         Нпп++;
      }
      НазвГорода = мСлова[Нпп];
   }
   Если( Вверх( Подстрока(НазвГорода, 1, 2 ) ) != "Г." )
   {
      Если( НазвГорода )
      {
         НазвБанка = НазвБанка + " " + НазвГорода;
         НазвГорода = "";
      }
      Сообщить( "У банка " + Название + "\nне указан город (Г.ГОРОД) в конце названия" );
   }
   Вернуть НазвГорода;
}

# реквизиты отправителя

Функция КБ_ПлательщикНазв()
{
   Если( Есть( ЛицоП.Наименование ) )
      Вернуть ЛицоП.Наименование;
   Вернуть "";
}

Функция КБ_ПлательщикИНН()
{
   Если( Есть( ЛицоП.ИНН ) )
      Вернуть ЛицоП.ИНН;
   Вернуть "";
}

Функция КБ_ПлательщикКПП()
{
   Перем пКПП = "";
   Если( Есть( ЛицоП.КПП ) )
      пКПП = Текст( ЛицоП.КПП );
   Иначе Если( Есть( КПП ) )
      пКПП = Текст( КПП );
   Вернуть пКПП ? пКПП : "0";
}

Функция КБ_ПлательщикРасчСчет()
{
   Если( Есть( 'Наш р/с-Платежи>Р/счет' ) )
      Вернуть 'Наш р/с-Платежи>Р/счет';
   Вернуть "";
}

Функция КБ_ПлательщикБанкНазв()
{
   Если( Есть( 'Наш р/с-Платежи.Банк-Р/с.Название банка' ) )
      Вернуть НазваниеБанка( 'Наш р/с-Платежи.Банк-Р/с.Название банка' );
   Вернуть "";
}

Функция КБ_ПлательщикБанкГород()
{
   Если( Есть( 'Наш р/с-Платежи.Банк-Р/с.Название банка' ) )
      Вернуть ГородБанка( 'Наш р/с-Платежи.Банк-Р/с.Название банка' );
   Вернуть "";
}

Функция КБ_ПлательщикБИК()
{
   Если( Есть( 'Наш р/с-Платежи>Банк-Р/с>БИК' ) )
      Вернуть 'Наш р/с-Платежи>Банк-Р/с>БИК';
   Вернуть "";
}

Функция КБ_ПлательщикКорСчет()
{
   Если( Есть( 'Наш р/с-Платежи>Банк-Р/с>КоррСчет' ) )
      Вернуть 'Наш р/с-Платежи>Банк-Р/с>КоррСчет';
   Вернуть "";
}

# реквизиты получателя

Функция КБ_ПолучательНазв()
{
   Если( Есть( 'Лицо1>Наименование' ) )
      Вернуть 'Лицо1>Наименование';
   Если( Есть( 'Лицо1>ФИО' ) )
      Вернуть 'Лицо1>ФИО';
   Вернуть "";
}

Функция КБ_ПолучательИНН()
{
   Если( Есть( 'Лицо1>ИНН' ) )
      Вернуть 'Лицо1>ИНН';
   Вернуть "";
}

Функция КБ_ПолучательКПП()
{
   Если( КБ_НалоговыйПлатеж() )
   {
      Перем пИНН = КБ_ПолучательИНН();
      Вернуть Размер( пИНН ) == 10 ? Подстрока( пИНН, 1, 4 )  + "01001" : "0";
   }
   Вернуть "";
}

Функция КБ_ПолучательРасчСчет()
{
   Если( Есть( 'Р/с-Платежи>Р/счет' ) )
      Вернуть 'Р/с-Платежи>Р/счет';
   Вернуть "";
}

Функция КБ_ПолучательБанкНазв()
{
   Если( Есть( 'Р/с-Платежи>Банк-Р/с>Название банка' ) )
      Вернуть НазваниеБанка( 'Р/с-Платежи>Банк-Р/с>Название банка' );
   Вернуть "";
}

Функция КБ_ПолучательБанкГород()
{
   Если( Есть( 'Р/с-Платежи>Банк-Р/с>Название банка' ) )
      Вернуть ГородБанка( 'Р/с-Платежи>Банк-Р/с>Название банка' );
   Вернуть "";
}

Функция КБ_ПолучательБИК()
{
   Если( Есть( 'Р/с-Платежи>Банк-Р/с>БИК' ) )
      Вернуть 'Р/с-Платежи>Банк-Р/с>БИК';
   Вернуть "";
}

Функция КБ_ПолучательКорСчет()
{
   Если( Есть( 'Р/с-Платежи>Банк-Р/с>КоррСчет' ) )
      Вернуть 'Р/с-Платежи>Банк-Р/с>КоррСчет';
   Вернуть "";
}

# реквизиты платежа

Функция КБ_НазначениеПлатежа1()
{
   Если( КБ_НалоговыйПлатеж() )
   {
      Если( Есть( Примечание ) )
      {
         Перем ПоказательОКАТО, ПоказательОснования, ПоказательПериода,
               ПоказательНомера, ПоказательДаты, ПоказательТипа, ПоказательДополнительно;
         Разбить( Примечание, ";",
            ПоказательОКАТО, ПоказательОснования, ПоказательПериода,
            ПоказательНомера, ПоказательДаты, ПоказательТипа, ПоказательДополнительно );
         Если( ПодСтрока( ПоказательДополнительно, 1, 1 ) == "\"" )
            ПоказательДополнительно = ПодСтрока( ПоказательДополнительно, 2, -1 );
         Если( ПодСтрока(ПоказательДополнительно, Размер(ПоказательДополнительно), 1 ) == "\"")
            ПоказательДополнительно = ПодСтрока( ПоказательДополнительно, 1, Размер(ПоказательДополнительно) - 1);
         Вернуть ПоказательДополнительно;
      }
   }
   Иначе
   {
      Если( Есть('Ключевая фраза') )
      {
         Перем пОснование, пКомментарий;
         Разбить( 'Ключевая фраза', "@", пОснование, пКомментарий ); 
         Вернуть Текст( пОснование, "Текст в" );
      }
   }
   Вернуть "";
}

Функция КБ_НазначениеПлатежа2()
{
   Если( КБ_НалоговыйПлатеж() )
   {
      Если( Есть( Приложение ) )
         Вернуть Приложение;
   }
   Иначе
   {
      Если( Есть( Примечание ) )
         Вернуть Примечание;
   }
   Вернуть "";
}

Функция КБ_НазначениеПлатежа3()
{
   Если( КБ_НалоговыйПлатеж() )
   {
      Вернуть "";
   }
   Иначе
   {
      Если( Есть( Приложение ) )
         Вернуть Приложение;
   }
   Вернуть "";
}

Функция КБ_НазначениеПлатежа()
{
   Вернуть Текст( КБ_НазначениеПлатежа1() + " " + КБ_НазначениеПлатежа2() + " " + КБ_НазначениеПлатежа3(), "Текст в" );
}

# Реквизиты налогового платежа

Функция КБ_НалоговыйПлатеж()
# Возвращает 1, если это налоговый платеж, 0 - иначе.
{
   Если( Есть( 'Ключевая фраза' ) )
   {
      Если( Подстрока( 'Ключевая фраза', 8, 1 ) == ";" 
          и Найти( "0123456789", Подстрока( 'Ключевая фраза', 1, 1 ) ) )
      Вернуть 1;
   }
   Вернуть 0;
}

Функция КБ_СтатусСоставителя()
{
   Если( КБ_НалоговыйПлатеж() )
   {
      Перем ПоказательКБК, СтатусСоставителя;
      Разбить('Ключевая фраза', ";", ПоказательКБК, СтатусСоставителя );
      Если( !Найти( ",01,02,03,04,05,06,07,08,", "," + СтатусСоставителя + "," ) )
      {
         Сообщить("Укажите в ключевой фразе правила операции через ';' 'Код бюджетной классификации' и 'Статус отправителя' (01,02,06,08 - согл. прил.5 Приказа МНС N БГ-3-10/98)");
         СтатусСоставителя = "";
      }
      Вернуть СтатусСоставителя;
   }
   Вернуть "";
}

Функция КБ_ПоказательКБК()
{
   Если( КБ_НалоговыйПлатеж() )
   {
      Перем ПоказательКБК, СтатусСоставителя;
      Разбить('Ключевая фраза', ";", ПоказательКБК, СтатусСоставителя );
      Вернуть ПоказательКБК;
   }
   Вернуть "";
}

Функция КБ_ПоказательОКАТО()
{
   Если( КБ_НалоговыйПлатеж() )
   {
      Если( Есть( Примечание ) )
      {
         Перем ПоказательОКАТО, ПоказательОснования, ПоказательПериода,
               ПоказательНомера, ПоказательДаты, ПоказательТипа, ПоказательДополнительно;
         Разбить( Примечание, ";",
            ПоказательОКАТО, ПоказательОснования, ПоказательПериода,
            ПоказательНомера, ПоказательДаты, ПоказательТипа, ПоказательДополнительно );
         Вернуть ПоказательОКАТО;
      }
   }
   Вернуть "";
}

Функция КБ_ПоказательОснования()
{
   Если( КБ_НалоговыйПлатеж() )
   {
      Если( Есть( Примечание ) )
      {
         Перем ПоказательОКАТО, ПоказательОснования, ПоказательПериода,
               ПоказательНомера, ПоказательДаты, ПоказательТипа, ПоказательДополнительно;
         Разбить( Примечание, ";",
            ПоказательОКАТО, ПоказательОснования, ПоказательПериода,
            ПоказательНомера, ПоказательДаты, ПоказательТипа, ПоказательДополнительно );
         Вернуть ПоказательОснования;
      }
   }
   Вернуть "";
}

Функция КБ_ПоказательПериода()
{
   Если( КБ_НалоговыйПлатеж() )
   {
      Если( Есть( Примечание ) )
      {
         Перем ПоказательОКАТО, ПоказательОснования, ПоказательПериода,
               ПоказательНомера, ПоказательДаты, ПоказательТипа, ПоказательДополнительно;
         Разбить( Примечание, ";",
            ПоказательОКАТО, ПоказательОснования, ПоказательПериода,
            ПоказательНомера, ПоказательДаты, ПоказательТипа, ПоказательДополнительно );
         Вернуть ПоказательПериода;
      }
   }
   Вернуть "";
}

Функция КБ_ПоказательНомера()
{
   Если( КБ_НалоговыйПлатеж() )
   {
      Если( Есть( Примечание ) )
      {
         Перем ПоказательОКАТО, ПоказательОснования, ПоказательПериода,
               ПоказательНомера, ПоказательДаты, ПоказательТипа, ПоказательДополнительно;
         Разбить( Примечание, ";",
            ПоказательОКАТО, ПоказательОснования, ПоказательПериода,
            ПоказательНомера, ПоказательДаты, ПоказательТипа, ПоказательДополнительно );
         Вернуть ПоказательНомера;
      }
   }
   Вернуть "";
}

Функция КБ_ПоказательДаты()
{
   Если( КБ_НалоговыйПлатеж() )
   {
      Если( Есть( Примечание ) )
      {
         Перем ПоказательОКАТО, ПоказательОснования, ПоказательПериода,
               ПоказательНомера, ПоказательДаты, ПоказательТипа, ПоказательДополнительно;
         Разбить( Примечание, ";",
            ПоказательОКАТО, ПоказательОснования, ПоказательПериода,
            ПоказательНомера, ПоказательДаты, ПоказательТипа, ПоказательДополнительно );
         Вернуть ПоказательДаты;
      }
   }
   Вернуть "";
}

Функция КБ_ПоказательТипа()
{
   Если( КБ_НалоговыйПлатеж() )
   {
      Если( Есть( Примечание ) )
      {
         Перем ПоказательОКАТО, ПоказательОснования, ПоказательПериода,
               ПоказательНомера, ПоказательДаты, ПоказательТипа, ПоказательДополнительно;
         Разбить( Примечание, ";",
            ПоказательОКАТО, ПоказательОснования, ПоказательПериода,
            ПоказательНомера, ПоказательДаты, ПоказательТипа, ПоказательДополнительно );
         Вернуть ПоказательТипа;
      }
   }
   Вернуть "";
}
