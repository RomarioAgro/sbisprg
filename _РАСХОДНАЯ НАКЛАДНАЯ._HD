# обработчик диалога 'Расходная накладная'
функция 'Расходная накладная'(Событие, Поле)
{
   ВыборПо(Событие)
   {
      Выбор "Инициализация":
         пИмяПрав='Правила-Документы.Имя';
         Если(пИмяПрав=="")
         {
            оПрав=Выборка("Правила операций");
            оПрав.Имя="РТ_ВОЗВ";
            Найти(оПрав,"Имя");
            Связать('Правила-Документы',оПрав);
            Очистить(оПрав);
         } 
         Если(Есть(Лицо1)==-1)
         {
            оЛицо=Лицо("СКЛАД","Орг");
            Связать(Лицо1,оЛицо);
            Очистить(оЛицо);
         } 
         Поле="@Штрих-Код";
         
         Вернуть Поле;
      Выбор "Изменение":
         Если(Поле=='@Штрих-Код')
         {
            _ДобавитьНаимПоКодуВозвр()
#             _ДобавитьНаимПоКоду("Расход");
            Поле="@Штрих-Код";
            '@Штрих-Код'="";
            Вернуть Поле;
         }
         Если(Поле=="@ВидОтгрузки")
         {
            оПрав=Выборка("Правила операций");
            оПрав.Имя=@ВидОтгрузки=="Возврат"?"РТ_ВОЗВ":"РТ_БРАК";
            Найти(оПрав,"Имя");
            Связать('Правила-Документы',оПрав);
            Очистить(оПрав);
         }
         Вернуть "";
      Выбор "Сохранение":
         Если('@Штрих-Код'!="")
         {
            _ДобавитьНаимПоКодуВозвр()
            Поле="@Штрих-Код";
            '@Штрих-Код'="";
            
            'Документ_.Документ_.ВидЦены'=ВидЦены("Продажа");
   ДляВсех(Наименований)
      {
         
         Если(ЦенаНаДату('Документ_.Дата',"Цена2"))
            НАИМ.НачЦена=ЦенаНаДату('Документ_.Дата',"Цена2");
         Иначе
            НАИМ.НачЦена=ЦенаНаДату('Документ_.Дата',"Цена3");
         Сохранить(НАИМ);
      }

            Вернуть Поле;



         }
         Вернуть "";
   }
   Вернуть "";
}
